{"version":3,"sources":["xml-parsers.js"],"names":[],"mappings":"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","file":"xml-parsers.js","sourcesContent":["/*\n * Minio Javascript Library for Amazon S3 Compatible Cloud Storage, (C) 2015 Minio, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport util from 'util'\nimport Concat from 'concat-stream';\nimport xml2js from 'xml2js'\nimport _ from 'lodash'\nimport * as errors from './errors.js';\n\nvar options = {  // options passed to xml2js parser\n  explicitRoot: false,    // return the root node in the resulting object?\n  ignoreAttrs: true,     // ignore attributes, only create text nodes\n}\n\nvar parseXml = (xml) => {\n  var result = null;\n  var error = null;\n\n  var parser = new xml2js.Parser(options);\n  parser.parseString(xml, function (e, r) {\n    error = e;\n    result = r;\n  });\n\n  if (error) {\n    throw new Error('XML parse error');\n  }\n  return result;\n}\n\n// Parse XML and return information as Javascript types\n\n// parse error XML response\nexport function parseError(xml, headerInfo) {\n  var xmlError = {}\n  var xmlobj = parseXml(xml)\n  var message\n  _.each(xmlobj, (n, key) => {\n    if (key === 'Message') {\n      message = xmlobj[key][0]\n      return\n    }\n    xmlError[key.toLowerCase()] = xmlobj[key][0]\n  })\n  var e = new errors.S3Error(message)\n  _.each(xmlError, (value, key) => {\n    e[key] = value\n  })\n  _.each(headerInfo, (value, key) => {\n    e[key] = value\n  })\n  return e\n}\n\n// parse XML response for listing in-progress multipart uploads\nexport function parseListMultipart(xml) {\n  var result = {\n    uploads: [],\n    prefixes: [],\n    isTruncated: false\n  }\n  var xmlobj =  parseXml(xml)\n  if (xmlobj.IsTruncated && xmlobj.IsTruncated[0] === 'true') result.isTruncated = true\n  if (xmlobj.NextKeyMarker) result.nextKeyMarker =  xmlobj.NextKeyMarker[0]\n  if (xmlobj.NextUploadIdMarker) result.nextUploadIdMarker = xmlobj.NextUploadIdMarker[0]\n  if (xmlobj.CommonPrefixes) xmlobj.CommonPrefixes.forEach(prefix => {\n    result.prefixes.push({prefix: prefix[0]})\n  })\n  if (xmlobj.Upload) xmlobj.Upload.forEach(upload => {\n    result.uploads.push({\n      key: upload.Key[0],\n      uploadId: upload.UploadId[0],\n      initiated: new Date(upload.Initiated[0])\n    })\n  })\n  return result\n}\n\n// parse XML response to list all the owned buckets\nexport function parseListBucket(xml) {\n  var result = []\n  var xmlobj = parseXml(xml)\n  if (xmlobj.Buckets) {\n    if (xmlobj.Buckets[0].Bucket) {\n      xmlobj.Buckets[0].Bucket.forEach(bucket => {\n        var name = bucket.Name[0]\n        var creationDate = new Date(bucket.CreationDate[0])\n        result.push({name, creationDate})\n      })\n    }\n  }\n  return result\n}\n\n// parse XML response for bucket region\nexport function parseBucketRegion(xml) {\n  return parseXml(xml)\n}\n\n// parse XML response for list parts of an in progress multipart upload\nexport function parseListParts(xml) {\n  var xmlobj = parseXml(xml)\n  var result = {\n    isTruncated: false,\n    parts: [],\n    marker: undefined\n  }\n  if (xmlobj.IsTruncated && xmlobj.IsTruncated[0] === 'true') result.isTruncated = true\n  if (xmlobj.NextPartNumberMarker) result.marker = +xmlobj.NextPartNumberMarker[0]\n  if (xmlobj.Part) {\n    xmlobj.Part.forEach(p => {\n      var part = +p.PartNumber[0]\n      var lastModified = new Date(p.LastModified[0])\n      var etag = p.ETag[0].replace(/^\\\"/g, '').replace(/\\\"$/g, '')\n                           .replace(/^&quot;/g, '').replace(/&quot;$/g, '')\n                           .replace(/^&#34;/g, '').replace(/^&#34;$/g, '')\n      result.parts.push({part, lastModified, etag})\n    })\n  }\n  return result\n}\n\n// parse XML response when a new multipart upload is initiated\nexport function parseInitiateMultipart(xml) {\n  var xmlobj = parseXml(xml)\n  if (xmlobj.UploadId) return xmlobj.UploadId[0]\n  throw new errors.InvalidXMLError('UploadId missing in XML')\n}\n\n// parse XML response when a multipart upload is completed\nexport function parseCompleteMultipart(xml) {\n  var xmlobj = parseXml(xml)\n  var location = xmlobj.Location[0]\n  var bucket = xmlobj.Bucket[0]\n  var key = xmlobj.Key[0]\n  var etag = xmlobj.ETag[0].replace(/^\\\"/g, '').replace(/\\\"$/g, '')\n                           .replace(/^&quot;/g, '').replace(/&quot;$/g, '')\n                           .replace(/^&#34;/g, '').replace(/^&#34;$/g, '')\n\n  return {location, bucket, key, etag}\n}\n\n// parse XML response for list objects in a bucket\nexport function parseListObjects(xml) {\n  var result = {\n        objects: [],\n        isTruncated: false\n      }\n  var nextMarker\n  var xmlobj = parseXml(xml)\n  if (xmlobj.IsTruncated && xmlobj.IsTruncated[0] === 'true') result.isTruncated = true\n  if (xmlobj.Contents) {\n    xmlobj.Contents.forEach(content => {\n      var name = content.Key[0]\n      var lastModified = new Date(content.LastModified[0])\n      var etag = content.ETag[0].replace(/^\\\"/g, '').replace(/\\\"$/g, '')\n                                 .replace(/^&quot;/g, '').replace(/&quot;$/g, '')\n                                 .replace(/^&#34;/g, '').replace(/^&#34;$/g, '')\n      var size = +content.Size[0]\n      result.objects.push({name, lastModified, etag, size})\n      nextMarker = name\n    })\n  }\n  if (xmlobj.CommonPrefixes) {\n    xmlobj.CommonPrefixes.forEach(commonPrefix => {\n      var prefix = commonPrefix.Prefix[0]\n      var size = 0\n      result.objects.push({prefix, size})\n    })\n  }\n  if (result.isTruncated) {\n    result.nextMarker = xmlobj.NextMarker ? xmlobj.NextMarker[0]: nextMarker\n  }\n  return result\n}\n"],"sourceRoot":"/source/"}